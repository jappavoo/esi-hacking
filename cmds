#ip addr add 192.168.100.2/24 dev tap0
# on victim 
ip addr add 10.42.1.3/16 dev enp7s0f0np0 

ip link add link enp3s0f0np0 name priv579 type vlan id 579
ip link set priv579 up


ip link add br0 type bridge
ip link set priv579 master br0
ip link set tap0 master br0

ip link set br0 type bridge stp_state 1
ip link set br0 up


# esi create networks
#create control network
openstack network create ctl-net 
#   create a subnet for ip managment
openstack subnet create \
  --subnet-range "192.168.2.0/24" \
  --allocation-pool start=192.168.2.10,end=192.168.2.100 \
  --dns-nameserver  8.8.4.4 \
  --dns-nameserver  8.8.8.8 \
  --network ctl-net ctl-net-sub

# create a private network
openstack network create --internal --no-share  priv-net0

# create a trunk that who's native network is the control net
# has the private network added to it.
openstack esi trunk create --native-network ctl-net ctl-trunk
openstack esi trunk add network --tagged-networks priv-net0  ctl-trunk


#   add control node to trunk network so that it has access to both the ctl-net
#   (which will be nat'ed to the external) and the private network on which victim nodes
#   will be attached
openstack esi node network attach --trunk ctl-trunk --mac-address 00:0f:53:22:e0:70 oct4-14

#   create a router

#   add a floating ip and nat to control node

# add a victim node to the private network
openstack esi node network attach --network priv-net0 --mac-address 24:8a:07:1e:85:a0  MOC-R4PAC10U03-S3


